<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Forecasting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .spinner-border {
            display: none;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="mt-5">AI Forecasting Tool</h2>
        <form id="forecastForm" enctype="multipart/form-data">
            <div class="mb-3">
                <label for="file" class="form-label">Upload CSV</label>
                <input type="file" class="form-control" id="file" name="file" required>
            </div>
            <div class="mb-3">
                <label for="date_col" class="form-label">Select Date Column</label>
                <select class="form-select" id="date_col" name="date_col" required>
                    <!-- Dynamic options will be populated after file upload -->
                </select>
            </div>
            <div class="mb-3">
                <label for="value_col" class="form-label">Select Value Column</label>
                <select class="form-select" id="value_col" name="value_col" required>
                    <!-- Dynamic options will be populated after file upload -->
                </select>
            </div>
            <div class="mb-3">
                <label for="method" class="form-label">Select Forecast Method</label>
                <select class="form-select" id="method" name="method" required>
                    <option value="sma">Simple Moving Average (SMA)</option>
                    <option value="wma">Weighted Moving Average (WMA)</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="period" class="form-label">Select Aggregation Period</label>
                <select class="form-select" id="period" name="period" required>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="quarterly">Quarterly</option>
                    <option value="yearly">Yearly</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="forecast_period" class="form-label">Select Forecast Period (e.g., 8 weeks)</label>
                <input type="number" class="form-control" id="forecast_period" name="forecast_period" required min="1">
            </div>
            <button type="submit" class="btn btn-primary">Generate Forecast</button>
        </form>

        <div class="spinner-border text-primary mt-3" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>

        <div id="forecastResult" class="mt-4"></div>

    </div>

    <script>
        document.getElementById('forecastForm').addEventListener('submit', function(e) {
            e.preventDefault();
            let formData = new FormData(this);
            let spinner = document.querySelector('.spinner-border');
            let resultDiv = document.getElementById('forecastResult');
            spinner.style.display = 'block';
            resultDiv.innerHTML = '';

            fetch('/forecast', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                spinner.style.display = 'none';
                if (data.error) {
                    resultDiv.innerHTML = `<p class="error">${data.error}</p>`;
                } else {
                    // Display forecast data as table
                    let forecastData = data.forecast;
                    let table = '<table class="table"><thead><tr><th>Date</th><th>Forecast</th></tr></thead><tbody>';
                    forecastData.forEach(row => {
                        table += `<tr><td>${row.Date}</td><td>${row.Forecast}</td></tr>`;
                    });
                    table += '</tbody></table>';
                    resultDiv.innerHTML = table;
                }
            })
            .catch(error => {
                spinner.style.display = 'none';
                resultDiv.innerHTML = `<p class="error">Something went wrong: ${error}</p>`;
            });
        });
    </script>
</body>
</html>
